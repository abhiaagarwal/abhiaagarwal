---
import ArrowLeft from "@lucide/astro/icons/arrow-left";
import ArrowRight from "@lucide/astro/icons/arrow-right";
import NotebookText from "@lucide/astro/icons/notebook-text";
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";
import { getCollection } from "astro:content";
import dayjs from "dayjs";
import PostItem from "../../components/PostItem.astro";
import Base from "../../layouts/Base.astro";
import {
    bookmarkToPostItem,
    getHostname,
    PAGE_SIZE,
} from "../../util/bookmarks";

export const getStaticPaths = (async ({ paginate }) => {
    const bookmarks = await getCollection("bookmarks");
    return paginate(
        bookmarks.sort(
            (a, b) => b.data.created.getTime() - a.data.created.getTime(),
        ),
        { pageSize: PAGE_SIZE },
    );
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

// All paginated data is passed on the "page" prop
const { page } = Astro.props;
---

<Base
    title="Bookmarks"
    description="Abhi's bookmarks."
    type="website"
    publishedTime={dayjs()}
>
    <div class="mx-auto max-w-2xl">
        <div class="gap-2items-center mb-6 flex flex-col justify-between">
            <h1 class="font-serif text-3xl font-semibold text-dark">
                Bookmarks
            </h1>
            <p class="text-sm text-dark-gray">
                A list of links I've bookmarked, mostly technical.
            </p>
        </div>
        <ol
            id="bookmark-list"
            class="flex flex-col gap-8 md:gap-12"
            aria-label="Bookmark listing"
        >
            {
                page.data.map((bookmark) => {
                    const item = bookmarkToPostItem(bookmark);
                    return (
                        <PostItem item={item}>
                            <div slot="before-dates">
                                <span class="flex items-center gap-1 text-dark-gray">
                                    <NotebookText class="size-4" />
                                    {getHostname(bookmark.data.url)}
                                </span>
                            </div>
                        </PostItem>
                    );
                })
            }
        </ol>
        {
            page.lastPage > 1 && (
                <nav
                    class="mt-12 flex items-center justify-between border-t border-dark-gray pt-8 font-serif"
                    aria-label="Pagination"
                >
                    {page.url.prev ? (
                        <a
                            href={page.url.prev}
                            class="flex items-center justify-center rounded border border-dark-gray p-2 text-dark-gray transition-colors hover:border-dark hover:text-dark"
                            aria-label="Previous page"
                            data-astro-prefetch
                        >
                            <ArrowLeft class="size-4" />
                        </a>
                    ) : (
                        <span />
                    )}
                    {page.url.next && (
                        <a
                            href={page.url.next}
                            class="flex items-center justify-center rounded border border-dark-gray p-2 text-dark-gray transition-colors hover:border-dark hover:text-dark"
                            aria-label="Next page"
                            data-astro-prefetch
                        >
                            <ArrowRight class="size-4" />
                        </a>
                    )}
                </nav>
            )
        }
    </div>
</Base>
